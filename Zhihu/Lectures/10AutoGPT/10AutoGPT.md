# 10AutoGPT

Agent的实现中，最重要的是Planning模块。

## Prompt

### main主框架Prompt

先写prompt主框架的main.txt，然后根据langchain的要求，写main.json文件
然后写带嵌套的txt文件

### 一般的约束文件

约束文件constraint.txt。其中1-5是宏观约束，6-15是调试测试、考虑细节后进行纠偏的约束

resources.txt

performance_evaluation.txt

final_step.txt

### thought_instructions.txt

1. 关键概念: 任务中涉及的组合型概念或实体。已经明确获得取值的关键概念，将其取值完整备注在概念后。
2. 概念拆解: 将任务中的关键概念拆解为一系列待查询的子要素。每个关键概念一行，后接这个概念的子要素，每个子要素一行，行前以' -'开始。
   - 关键概念、概念拆解：销售额是单价*数量，做了拆解之后就能分析识别出子要素，这样再查询Excel文件，就能大大提高结果的准确度
   - “已经明确获得取值的关键概念，将其取值完整备注在概念后。”为了记录概念和值的对应关系，方便后续的查询和推理。
3. 反思:
自我反思，观察以前的执行记录，思考概念拆解是否完整、准确。
一步步思考是否每一个的关键概念或要素的查询都得到了准确的结果。
反思你已经得到哪个要素/概念。你的到的要素/概念取值是否正确。从当前的信息中还不能得到哪些要素/概念。
每个反思一行，行前以' -'开始。
4. 思考: 观察执行记录和你的自我反思，并一步步思考
  （1）分析要素间的依赖关系，例如：
    i. 我是否需要先获得A的值/定义，才能通过A来获得B？
    ii. 如果我先获得A，是否可以通过A筛选B，减少穷举每个B的代价？
    iii. A和B是否存在在同一数据源中，我能否在获取A的同时获取B？
    iv. 是否还有更高效或更聪明的办法来查询一个概念或要素？
    v. 如果上一次尝试查询一个概念或要素时失败了，我是否可以尝试从另一个资源中再次查询？
    vi. 诸如此类，你可以扩展更多的思考 ...
  （2）根据以上分析，排列子要素间的查询优先级
  （3）找出当前需要获得取值的子要素
  注意，不要对要素的取值/定义做任何假设，确保你的信息来自给定的数据源！
   - 所有要素的依赖关系，先查谁后查谁等等细致的步骤做了一次约束

5. 推理: 根据你的反思与思考，一步步推理被选择的子要素取值的获取方式。如果前一次的计划失败了，请检查输入中是否包含每个概念/要素的明确定义，并尝试细化你的查询描述。

6. 计划: 严格遵守以下规则，计划你的当前动作。
  （1）详细列出当前动作的执行计划。只计划一步的动作。PLAN ONE STEP ONLY!
  （2）一步步分析，包括数据源，对数据源的操作方式，对数据的分析方法。有哪些已知常量可以直接代入此次分析。
  （3）不要尝试计算文件的每一个元素，这种计算代价太高，是严格禁止的。你可以通过分析找到更有效的方法，比如条件筛选。
  （4）上述分析是否依赖某个要素的取值/定义，且该要素的取值/定义尚未获得。若果是，重新规划当前动作，确保所有依赖的要素的取值/定义都已经获得。
  （5）不要对要素的取值/定义做任何假设，确保你的信息来自给定的数据源。不要编造信息。DO NOT MAKE UP ANY INFORMATION!!!
  （6）确保你执行的动作涉及的所有要素都已获得确切的取值/定义。
  （7）如果全部子任务已完成，请用FINISH动作结束任务。
   - 对下一步的动作进行约束，确定下一步的action

## Utils

封装刚刚写好的主Prompt，见PromptTemplateBuilder.py

## Action

用pydantic定义实际让模型输出的action的JSON结构

## AutoGPT

最核心的是入口函数run

## Tools

看到126min，继续答疑
